



## 流 程 

1 ． 从 库 发 起 同 步 请 求 

2 ． 主 库 收 到 请 求 后 执 行 bg “ ve 保 存 当 前 内 存 里 的 数 据 到 磁 盘 

3 ． 主 库 将 持 久 化 的 数 据 发 送 给 从 库 的 数 据 目 录 

4 ． 从 库 收 到 主 库 的 持 久 化 数 据 之 后 ， 先 清 空 自 己 当 前 内 存 中 的 所 有 数 据 

5 ． 从 库 将 主 库 发 送 过 来 的 持 久 化 文 件 加 载 到 自 己 的 内 存 里 

## 局 限 性 ． 

1 ． 执 行 主 从 复 制 之 前 ， 现 将 数 据 备 份 一 份 

2 ． 建 议 将 主 从 复 制 写 入 到 配 置 又 件 中 

3 ． 在 业 务 低 峰 期 做 主 从 复 制 ， 

4 ． 拷 贝 数 据 时 候 会 占 用 蒂 宽 

5 ． 不 能 自 动 完 成 主 从 切 换 ， 需 要 人 工 介 入 

## 环境准备

安装参考：[linux基础命令](linux/commond.md)

``` shell
##打包redis 文件
[root@db01 /opt]# tar zcvf db01_redis.tar.gz /opt/redis_cluster/
#拷贝文件到第二台redis服务器中
[root@db01 /opt]#scp db01_redis.tar.gz db02:/opt
#执行安装文件
[root@db02 /opt/redis_cluster/redis]#make install
cd src && make install
make[1]: Entering directory `/opt/redis_cluster/redis-3.2.12/src'
Hint: It's a good idea to run 'make test' ;)
    INSTALL install
    INSTALL install
    INSTALL install
    INSTALL install
    INSTALL install
make[1]: Leaving directory `/opt/redis_cluster/redis-3.2.12/src'
#创建数据库目录
[root@db02 /opt/redis_cluster/redis]#mkdir -p /data/redis_cluster/redis_6379/


```

主从配置

``` shell
[root@db02 /opt/redis_cluster]#redis-cli -h db02
db02:6379> SLAVEOF db01 6379
OK
db02:6379> keys *
1) "nam2"
2) "name"
3) "name1"
db02:6379> 
```

哨兵配置

```reStructuredText
自 动 故 障 迁 移 (Automaticfailover ：  当 一 个 土 服 务 器 不 能 正 常 工 作 时 ， Sentinel 会 廾 始 一 钦 自 动 故 障 迁 移 操 作 ， 它 会 将 失 效 王 务 器 的 其 中 一 个 从  务 器 升 级 为 新 的 主 务 器 ， # 让 失 效 主 服 务 的 其 他 从 服 务 器 改 为 复 制 新 的 主 服 务 器 ； 当 客 户 端 试 图 莲 接 失  效 的 主 务 器 时 ， 集 群 也 会 向 客 户 端 返 回 新 主 服 务 器 的 地 址 ， 使 得 集 群 可 以 使 用 新 主 服 务 器 代 替 失 牖 务 器 
```

![image-20210421175359754](https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/imgimage-20210421175359754.png)
