# redis集群配置

``` shell
思路
1、部署一台服务上的2个集群节点（实验，节省咨询，不代表生成环境）
2、发送完成后修改其他主机的ip地址

```

``` shell
# db01操作
[root@db01 ~]# mkdir -p /opt/redis_cluster/redis_{6380,6381}/{conf,log,pid}
[root@db01 ~]# tree /opt/redis_cluster/redis_{6380,6381}/{conf,log,pid}
/opt/redis_cluster/redis_6380/conf
/opt/redis_cluster/redis_6380/log
/opt/redis_cluster/redis_6380/pid
/opt/redis_cluster/redis_6381/conf
/opt/redis_cluster/redis_6381/log
/opt/redis_cluster/redis_6381/pid

0 directories, 0 files
[root@db01 ~]# mkdir -p /data/redis_cluster/redis_{6380,6381}
[root@db01 ~]# tree /data/redis_cluster/redis_{6380,6381}
/data/redis_cluster/redis_6380
/data/redis_cluster/redis_6381

0 directories, 0 files
[root@db01 ~]# 

cat >/opt/redis_cluster/redis_6380/conf/redis_6380.conf<<EOF
bind 10.0.0.51
port 6380
daemonize yes
pidfile "/opt/redis_cluster/redis_6380/pid/redis_6380.pid"
logfie "/opt/redis_cluster/redis_6380/log/redis_6380.log"
dbfilename "redis_6380.rdb"
#集群的配置文件的位置
dir "/data/redis_cluster/redis_6380"
#激活集群模式
cluster-enabled yes
#集群的配置文件
cluster-config-file nodes_6380.conf
#集群的超时时间
cluster-node-timeout 15000
appendonly no
maxmemory 1171875kb
EOF

[root@db01 /opt/redis_cluster]# cp /opt/redis_cluster/redis_6380/conf/redis_6380.conf  /opt/redis_cluster/redis_6381/conf/redis_6381.conf
[root@db01 /opt/redis_cluster]# sed -i 's#6380#6381#g' redis_6381/conf/redis_6381.conf
root@db01 /opt/redis_cluster]# cat redis_6381/conf/redis_6381.conf bind 10.0.0.51
port 6381
daemonize yes
pidfile "/opt/redis_cluster/redis_6381/pid/redis_6381.pid"
logfie "/opt/redis_cluster/redis_6381/log/redis_6381.log"
dbfilename "redis_6381.rdb"
#集群的配置文件的位置
dir "/data/redis_cluster/redis_6381"
#激活集群模式
cluster-enabled yes
#集群的配置文件
cluster-config-file nodes_6381.conf
#集群的超时时间
cluster-node-timeout 15000
appendonly no
maxmemory 1171875kb
[root@db01 /opt/redis_cluster]# rsync -avz /opt63* db02:/opt/redis_cluster/
[root@db01 /opt/redis_cluster]# rsync -avz /opt63* db03:/opt/redis_cluster/


```

![image-20210421233813182](https://cdn.jsdelivr.net/gh/fhwlnetwork/blos_imgs/img/1619019483(1).png)

``` shell
#db02上操作
mkdir /data/redis_cluster/redis_{6380,6381}
find /opt/redis_cluster/redis_638* -type f -name "*.conf" |xargs sed -i "/bind/s#51#52#g"
[root@db02 ~]# sed -i 's#51#52#g' /opt/redis_cluster/redis_6380/conf/redis_6380.conf
[root@db02 ~]# sed -i 's#51#52#g' /opt/redis_cluster/redis_6381/conf/redis_6381.conf
[root@db02 ~]# redis-server /opt/redis_cluster/redis_6381/conf/redis_6381.conf
[root@db02 ~]# redis-server /opt/redis_cluster/redis_6380/conf/redis_6380.conf
#db03上操作
mkdir /data/redis_cluster/redis_{6380,6381}
find /opt/redis_cluster/redis_638* -type f -name "*.conf" |xargs sed -i "/bind/s#51#53#g"
[root@db02 ~]# sed -i 's#51#53#g' /opt/redis_cluster/redis_6380/conf/redis_6380.conf
[root@db02 ~]# sed -i 's#51#53#g' /opt/redis_cluster/redis_6381/conf/redis_6381.conf
[root@db02 ~]# redis-server /opt/redis_cluster/redis_6381/conf/redis_6381.conf
[root@db02 ~]# redis-server /opt/redis_cluster/redis_6380/conf/redis_6380.conf

```

